<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <link rel="stylesheet" href="/public/css/editor.css" />
    <!-- your custom styles -->
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        display: flex;
        height: 100vh;
        overflow: hidden;
      }
      #fileList {
        width: 250px;
        background: #f4f4f4;
        padding: 10px;
        overflow-y: auto;
        border-right: 1px solid #ccc;
      }
      #editorContainer {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #editor {
        flex: 1;
        height: 100%;
        width: 100%;
      }
      button {
        margin: 10px;
        padding: 10px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>

    <!--LOGOUT BUTTON-->
    <div class="navbar">
      <span>Admin Panel</span>
      <div class="nav-actions">
        <button onclick="toggleTheme()">ðŸŒ™</button>
        <button id="logoutBtn" class="logout-btn">Logout</button>
      </div>
    </div>



<!-- Logout Confirmation Container -->
<div id="logoutModal" class="modal">
  <div class="modal-content">
    <p>Are you sure you want to log out?</p>
    <div class="modal-actions">
      <button id="confirmLogout">Proceed</button>
      <button id="cancelLogout">Cancel</button>
    </div>
  </div>
</div>




    <div id="fileList"></div>
    <div id="editorContainer">
      <div id="editor"></div>
      <button onclick="saveFile()">Save</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.min.js"></script>
    <script>
      let currentFile = "";
      let editor;

      // Load file list from server
      fetch("/files")
        .then((res) => res.json())
        .then((files) => {
          const list = document.getElementById("fileList");
          files.forEach((f) => {
            const btn = document.createElement("button");
            btn.textContent = f;
            btn.style.width = "100%";
            btn.style.textAlign = "left";
            btn.onclick = () => loadFile(f);
            list.appendChild(btn);
          });
        });

      // Setup Monaco Editor
  
  require.config({
    paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs" }
  });

  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById("editor"), {
      value: "",
      language: "html",
      theme: document.body.classList.contains('dark') ? 'vs-dark' : 'vs',
      automaticLayout: true,
    });

    // expose editor and monaco on window for toggleTheme access
    window.editor = editor;
    window.monaco = monaco;
  });


      // Load selected file into editor
      function loadFile(file) {
        currentFile = file;
        fetch("/file/" + encodeURIComponent(file))
          .then((res) => res.text())
          .then((text) => {
            editor.setValue(text);
            // Set language mode by file extension
            const ext = file.split(".").pop().toLowerCase();
            let lang = "plaintext";
            if (ext === "html") lang = "html";
            else if (ext === "css") lang = "css";
            else if (ext === "js") lang = "javascript";
            monaco.editor.setModelLanguage(editor.getModel(), lang);
          });
      }

      // Save editor content back to server
      function saveFile() {
        if (!currentFile) {
          alert("Please select a file first!");
          return;
        }
        fetch("/file/" + encodeURIComponent(currentFile), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content: editor.getValue() }),
        })
          .then((res) => res.json())
          .then((data) => alert("Saved!"))
          .catch((err) => alert("Error saving file"));
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Load theme
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          document.body.classList.add("dark");
        }

        // Handle logout
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async (e) => {
            e.preventDefault(); // prevent form submission reload
            try {
              const res = await fetch("/logout");
              const data = await res.json();
              if (data.success) {
                window.location.href = data.redirect;
              } else {
                alert("Logout failed");
              }
            } catch (error) {
              console.error("Logout error:", error);
            }
          });
        }
      });
    </script>

<script>
  // global theme toggle used by the navbar button (onclick="toggleTheme()")
  window.toggleTheme = function () {
    const isDark = document.body.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');

    // update Monaco theme if it's ready
    try {
      if (window.monaco && typeof monaco.editor.setTheme === 'function') {
        monaco.editor.setTheme(isDark ? 'vs-dark' : 'vs');
      }
    } catch (e) {
      console.warn('Monaco theme change failed (it may not be loaded yet).', e);
    }
  };

  // on load: apply saved theme (or prefer system)
  document.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('theme');
    if (saved === 'dark') {
      document.body.classList.add('dark');
      // if Monaco is already loaded the require block above will set its theme; otherwise this ensures monaco theme toggle works later
      if (window.monaco && typeof monaco.editor.setTheme === 'function') {
        monaco.editor.setTheme('vs-dark');
      }
    } else if (saved === 'light') {
      document.body.classList.remove('dark');
      if (window.monaco && typeof monaco.editor.setTheme === 'function') {
        monaco.editor.setTheme('vs');
      }
    } else {
      // no saved preference -> match system preference
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
        if (window.monaco && typeof monaco.editor.setTheme === 'function') monaco.editor.setTheme('vs-dark');
      }
    }
  });
</script>




  </body>
</html>